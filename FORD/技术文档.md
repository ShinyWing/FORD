# FORDå¤šè½®è¾©è®ºæ¡†æ¶æŠ€æœ¯æ–‡æ¡£

## ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [è®ºæ–‡èƒŒæ™¯ä¸ç†è®ºåŸºç¡€](#2-è®ºæ–‡èƒŒæ™¯ä¸ç†è®ºåŸºç¡€)
3. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#3-ç³»ç»Ÿæ¶æ„è®¾è®¡)
4. [æ ¸å¿ƒæ¨¡å—å®ç°](#4-æ ¸å¿ƒæ¨¡å—å®ç°)
5. [å…³é”®ç®—æ³•å®ç°](#5-å…³é”®ç®—æ³•å®ç°)
6. [APIé›†æˆä¸é…ç½®](#6-apié›†æˆä¸é…ç½®)
7. [æ•°æ®æµç¨‹ä¸çŠ¶æ€ç®¡ç†](#7-æ•°æ®æµç¨‹ä¸çŠ¶æ€ç®¡ç†)
8. [ç”¨æˆ·ç•Œé¢è®¾è®¡](#8-ç”¨æˆ·ç•Œé¢è®¾è®¡)
9. [æµ‹è¯•ä¸éªŒè¯](#9-æµ‹è¯•ä¸éªŒè¯)
10. [éƒ¨ç½²ä¸ä¼˜åŒ–](#10-éƒ¨ç½²ä¸ä¼˜åŒ–)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
æœ¬é¡¹ç›®åŸºäºè®ºæ–‡ã€ŠExamining Inter-Consistency of Large Language Models Collaboration: An In-depth Analysis via Debateã€‹ï¼Œå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„FORDï¼ˆFocus on Reasoning and Discussionï¼‰å¤šè½®è¾©è®ºæ¡†æ¶æ¼”ç¤ºåº”ç”¨ã€‚è¯¥åº”ç”¨é€šè¿‡æµ·é¾Ÿæ±¤è°œé¢˜ä½œä¸ºæµ‹è¯•è½½ä½“ï¼Œå±•ç¤ºå¤§è¯­è¨€æ¨¡å‹é—´åä½œè¾©è®ºçš„å…¨è¿‡ç¨‹ï¼Œå¹¶é‡åŒ–åˆ†æè¾©è®ºæ•ˆæœã€‚

### 1.2 æŠ€æœ¯æ ˆ
- **å‰ç«¯æ¡†æ¶**: React 18 + TypeScript
- **UIç»„ä»¶åº“**: Ant Design + è‡ªå®šä¹‰CSS
- **å›¾è¡¨å¯è§†åŒ–**: Recharts
- **AIæœåŠ¡**: OpenAI GPT API
- **çŠ¶æ€ç®¡ç†**: React Hooks
- **æ„å»ºå·¥å…·**: Create React App

### 1.3 æ ¸å¿ƒç‰¹æ€§
-  å®Œæ•´æ˜ å°„FORDæ¡†æ¶äº”å¤§é˜¶æ®µ
-  æ”¯æŒå¤šç§GPTæ¨¡å‹ç»„åˆå®éªŒ
-  å®æ—¶INCONæŒ‡æ•°å¯è§†åŒ–
-  äº¤äº’å¼è¾©è®ºç«æŠ€åœº
-  é‡åŒ–åˆ†æè¾©è®ºå¢ç›Šæ•ˆæœ
-  ç°ä»£åŒ–å“åº”å¼UIè®¾è®¡

---

## 2. è®ºæ–‡èƒŒæ™¯ä¸ç†è®ºåŸºç¡€

### 2.1 FORDæ¡†æ¶æ ¸å¿ƒæ¦‚å¿µ

**FORDï¼ˆFocus on Reasoning and Discussionï¼‰æ¡†æ¶**æ˜¯ä¸€ç§ç ”ç©¶å¤§è¯­è¨€æ¨¡å‹åä½œæ¨ç†èƒ½åŠ›çš„æ–¹æ³•è®ºï¼Œé€šè¿‡ç»“æ„åŒ–çš„è¾©è®ºè¿‡ç¨‹æ¥åˆ†ææ¨¡å‹é—´çš„ä¸€è‡´æ€§å˜åŒ–ã€‚

#### 2.1.1 å…³é”®æŒ‡æ ‡

**INCONï¼ˆInconsistencyï¼‰æŒ‡æ•°**
- å®šä¹‰ï¼šè¡¡é‡ä¸¤ä¸ªæ¨¡å‹ç­”æ¡ˆé—´è¯­ä¹‰å·®å¼‚ç¨‹åº¦çš„æŒ‡æ ‡
- è®¡ç®—æ–¹å¼ï¼šåŸºäºè¯­ä¹‰ç›¸ä¼¼åº¦çš„å¤åˆç®—æ³•
- å–å€¼èŒƒå›´ï¼š0-1ï¼ˆ0è¡¨ç¤ºå®Œå…¨ä¸€è‡´ï¼Œ1è¡¨ç¤ºå®Œå…¨ä¸ä¸€è‡´ï¼‰
- ä½œç”¨ï¼šåŠ¨æ€ç›‘æ§è¾©è®ºè¿‡ç¨‹ä¸­çš„å…±è¯†æ¼”è¿›

**è¾©è®ºå¢ç›Šï¼ˆDebate Gainï¼‰**
- å®šä¹‰ï¼šé€šè¿‡è¾©è®ºè¿‡ç¨‹æå‡ç­”æ¡ˆå‡†ç¡®æ€§çš„æ•ˆæœ
- è®¡ç®—ï¼šæœ€ç»ˆå‡†ç¡®ç‡ - åˆå§‹å‡†ç¡®ç‡
- æ„ä¹‰ï¼šéªŒè¯å¤šæ¨¡å‹åä½œçš„ä»·å€¼

### 2.2 å®éªŒè®¾è®¡åŸç†

#### 2.2.1 å¯¹ç…§ç»„è®¾è®¡
```
å…¬å¹³è¾©è®ºç»„: é«˜èƒ½åŠ›æ¨¡å‹ vs é«˜èƒ½åŠ›æ¨¡å‹ (GPT-4 vs Claude-3-Opus)
ä¸åŒ¹é…ç»„: é«˜èƒ½åŠ›æ¨¡å‹ vs ä½èƒ½åŠ›æ¨¡å‹ (GPT-4 vs GPT-3.5-Turbo)
```

#### 2.2.2 è¯„ä¼°ç»´åº¦
1. **å‡†ç¡®ç‡æå‡**: åˆå§‹ â†’ æœ€ç»ˆç­”æ¡ˆæ­£ç¡®æ€§å¯¹æ¯”
2. **å…±è¯†æ¼”è¿›**: INCONæŒ‡æ•°éšè½®æ¬¡çš„å˜åŒ–è¶‹åŠ¿
3. **æ•ˆç‡è¯„ä¼°**: è¾¾æˆå…±è¯†æ‰€éœ€è½®æ•°
4. **è´¨é‡è¯„åˆ†**: è£åˆ¤æ¨¡å‹å¯¹æœ€ç»ˆç­”æ¡ˆçš„è¯„åˆ†

---

## 3. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 3.1 æ•´ä½“æ¶æ„å›¾

```mermaid
graph TB
    A[ç”¨æˆ·ç•Œé¢å±‚] --> B[ç»„ä»¶å±‚]
    B --> C[æœåŠ¡å±‚]
    C --> D[AIæœåŠ¡å±‚]
    
    subgraph ç”¨æˆ·ç•Œé¢å±‚
        A1[App.tsx<br/>ä¸»åº”ç”¨å®¹å™¨]
        A2[Stepsç»„ä»¶<br/>è¿›åº¦å¯¼èˆª]
        A3[Layoutå¸ƒå±€<br/>é¡µé¢ç»“æ„]
    end
    
    subgraph ç»„ä»¶å±‚
        B1[ExperimentConfig<br/>å®éªŒé…ç½®]
        B2[InitialEvaluation<br/>åˆå§‹è¯„ä¼°]
        B3[DebateArena<br/>è¾©è®ºç«æŠ€åœº]
        B4[JudgeVerdict<br/>è£åˆ¤è£å†³]
        B5[ExperimentReport<br/>å®éªŒæŠ¥å‘Š]
    end
    
    subgraph æœåŠ¡å±‚
        C1[aiService.ts<br/>AIæœåŠ¡å°è£…]
        C2[ç±»å‹å®šä¹‰<br/>TypeScript Types]
        C3[æ¨¡æ‹Ÿæ•°æ®<br/>Mock Data]
        C4[çŠ¶æ€ç®¡ç†<br/>React Hooks]
    end
    
    subgraph AIæœåŠ¡å±‚
        D1[OpenAI API<br/>GPTæ¨¡å‹è°ƒç”¨]
        D2[INCONç®—æ³•<br/>ä¸€è‡´æ€§è®¡ç®—]
        D3[è¯„ä¼°ç®—æ³•<br/>ç­”æ¡ˆæ­£ç¡®æ€§]
        D4[è¾©è®ºé€»è¾‘<br/>å¯¹è¯ç”Ÿæˆ]
    end
    
    B1 --> C1
    B2 --> C1
    B3 --> C1
    B4 --> C1
    B5 --> C3
    
    C1 --> D1
    C1 --> D2
    C1 --> D3
    C1 --> D4
```

### 3.2 æŠ€æœ¯æ¶æ„åˆ†å±‚

#### 3.2.1 è¡¨ç°å±‚ï¼ˆPresentation Layerï¼‰
- **ä¸»è¦ç»„ä»¶**: Reactç»„ä»¶æ ‘
- **èŒè´£**: ç”¨æˆ·äº¤äº’ã€æ•°æ®å±•ç¤ºã€çŠ¶æ€å±•ç¤º
- **æŠ€æœ¯**: React 18 + TypeScript + Ant Design

#### 3.2.2 ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰
- **ä¸»è¦æ¨¡å—**: AIServiceã€ç®—æ³•æœåŠ¡
- **èŒè´£**: ä¸šåŠ¡è§„åˆ™å®ç°ã€æ•°æ®å¤„ç†ã€ç®—æ³•è®¡ç®—
- **æ ¸å¿ƒåŠŸèƒ½**: INCONè®¡ç®—ã€ç­”æ¡ˆè¯„ä¼°ã€è¾©è®ºé€»è¾‘

#### 3.2.3 æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰
- **ä¸»è¦æ¥å£**: OpenAI API
- **èŒè´£**: å¤–éƒ¨æœåŠ¡è°ƒç”¨ã€æ•°æ®è·å–
- **ç‰¹ç‚¹**: å¼‚æ­¥å¤„ç†ã€é”™è¯¯é‡è¯•ã€é™çº§æœºåˆ¶

### 3.3 æ•°æ®æµæ¶æ„

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant A as Appç»„ä»¶
    participant C as å­ç»„ä»¶
    participant S as AIService
    participant O as OpenAI API
    
    U->>A: 1. é…ç½®å®éªŒå‚æ•°
    A->>C: 2. ä¼ é€’é…ç½®
    C->>S: 3. è¯·æ±‚åˆå§‹ç­”æ¡ˆ
    S->>O: 4. è°ƒç”¨GPT API
    O-->>S: 5. è¿”å›å›ç­”
    S->>S: 6. è®¡ç®—INCONæŒ‡æ•°
    S-->>C: 7. è¿”å›åˆ†æç»“æœ
    C-->>A: 8. æ›´æ–°çŠ¶æ€
    A-->>U: 9. æ˜¾ç¤ºç»“æœ
    
    loop å¤šè½®è¾©è®º
        U->>A: 10. è§¦å‘ä¸‹ä¸€è½®
        A->>C: 11. å¯åŠ¨è¾©è®º
        C->>S: 12. ç”Ÿæˆè¾©è®ºå›åº”
        S->>O: 13. è°ƒç”¨APIç”Ÿæˆå›åº”
        O-->>S: 14. è¿”å›è¾©è®ºå†…å®¹
        S->>S: 15. é‡æ–°è®¡ç®—INCON
        S-->>C: 16. è¿”å›è¾©è®ºæ•°æ®
        C-->>A: 17. æ›´æ–°è¾©è®ºå†å²
        A-->>U: 18. å®æ—¶æ˜¾ç¤ºè¿›å±•
    end
    
    U->>A: 19. è§¦å‘æœ€ç»ˆè£å†³
    A->>C: 20. å¯åŠ¨è£åˆ¤è¯„ä¼°
    C->>S: 21. è¯·æ±‚è£åˆ¤åˆ†æ
    S->>O: 22. è°ƒç”¨è£åˆ¤æ¨¡å‹
    O-->>S: 23. è¿”å›æœ€ç»ˆè¯„ä¼°
    S-->>C: 24. è¿”å›è£å†³ç»“æœ
    C-->>A: 25. å®Œæˆå®éªŒ
    A-->>U: 26. æ˜¾ç¤ºå®Œæ•´æŠ¥å‘Š
```

### 3.4 æ–‡ä»¶ç»“æ„ç»„ç»‡

```
src/
â”œâ”€â”€ components/           # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ExperimentConfig.tsx    # å®éªŒé…ç½®æ¨¡å—
â”‚   â”œâ”€â”€ InitialEvaluation.tsx   # åˆå§‹è¯„ä¼°æ¨¡å—
â”‚   â”œâ”€â”€ DebateArena.tsx         # è¾©è®ºç«æŠ€åœºæ¨¡å—
â”‚   â”œâ”€â”€ JudgeVerdict.tsx        # è£åˆ¤è£å†³æ¨¡å—
â”‚   â””â”€â”€ ExperimentReport.tsx    # å®éªŒæŠ¥å‘Šæ¨¡å—
â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ aiService.ts     # AIæœåŠ¡æ ¸å¿ƒé€»è¾‘
â”‚   â””â”€â”€ apiTest.ts       # APIè¿æ¥æµ‹è¯•
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ openai.ts        # OpenAI APIé…ç½®
â”œâ”€â”€ types/               # TypeScriptç±»å‹å®šä¹‰
â”‚   â””â”€â”€ index.ts         # æ‰€æœ‰ç±»å‹å®šä¹‰
â”œâ”€â”€ data/                # æ•°æ®æ¨¡å—
â”‚   â””â”€â”€ mockData.ts      # æ¨¡æ‹Ÿæ•°æ®
â”œâ”€â”€ App.tsx              # ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ index.tsx            # åº”ç”¨å…¥å£ç‚¹
â””â”€â”€ index.css            # å…¨å±€æ ·å¼
```

---

## 4. æ ¸å¿ƒæ¨¡å—å®ç°

### 4.1 ä¸»åº”ç”¨æ§åˆ¶å™¨ï¼ˆApp.tsxï¼‰

#### 4.1.1 çŠ¶æ€ç®¡ç†è®¾è®¡

App.tsxä½œä¸ºæ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ç®¡ç†ä¸­å¿ƒï¼Œé‡‡ç”¨React Hooksè¿›è¡ŒçŠ¶æ€æ§åˆ¶ï¼š

```typescript
// æ ¸å¿ƒçŠ¶æ€å®šä¹‰
const [currentStep, setCurrentStep] = useState(0);
const [experimentConfig, setExperimentConfig] = useState<ExperimentConfigType | null>(null);
const [initialAnswers, setInitialAnswers] = useState<InitialAnswer[]>([]);
const [initialIncon, setInitialIncon] = useState<number>(0);
const [debateMessages, setDebateMessages] = useState<DebateMessage[]>([]);
const [finalIncon, setFinalIncon] = useState<number>(0);
const [totalRounds, setTotalRounds] = useState<number>(0);
const [judgeEvaluation, setJudgeEvaluation] = useState<JudgeEvaluation | null>(null);
const [inconData, setInconData] = useState<InconData[]>([]);
```

#### 4.1.2 é˜¶æ®µæµç¨‹æ§åˆ¶

```typescript
// æ­¥éª¤å®šä¹‰ - æ˜ å°„FORDæ¡†æ¶äº”å¤§é˜¶æ®µ
const steps = [
  { title: 'å®éªŒå‚æ•°è®¾å®š', description: 'é€‰æ‹©è°œé¢˜å’Œè¾©æ‰‹æ¨¡å‹' },
  { title: 'åˆå§‹å›ç­”ä¸åŸºå‡†è¯„ä¼°', description: 'è·å–åˆå§‹ç­”æ¡ˆå¹¶è¯„ä¼°' },
  { title: 'å®æ—¶è¾©è®ºç«æŠ€åœº', description: 'å¤šè½®è¾©è®ºä¸åŠ¨æ€ç›‘æ§' },
  { title: 'è£åˆ¤è£å†³ä¸å¢ç›Šåˆ†æ', description: 'æœ€ç»ˆè£å†³å’Œæ•ˆæœåˆ†æ' },
  { title: 'ç»¼åˆå®éªŒæŠ¥å‘Š', description: 'å®Œæ•´å®éªŒç»“æœæ±‡æ€»' }
];

// å¯¼èˆªæ§åˆ¶é€»è¾‘
const navigateToStep = (step: number) => {
  // éªŒè¯å¿…è¦æ¡ä»¶
  if (step >= 1 && !experimentConfig) {
    alert('è¯·å…ˆå®Œæˆå®éªŒé…ç½®ï¼');
    return;
  }
  if (step >= 2 && initialAnswers.length === 0) {
    alert('è¯·å…ˆå®Œæˆåˆå§‹è¯„ä¼°ï¼');
    return;
  }
  // ... å…¶ä»–éªŒè¯é€»è¾‘
  setCurrentStep(step);
};
```

### 4.2 å®éªŒé…ç½®æ¨¡å—ï¼ˆExperimentConfig.tsxï¼‰

#### 4.2.1 è®ºæ–‡å®ç°ï¼šå®éªŒåˆ†ç»„è®¾è®¡

è¯¥æ¨¡å—ç›´æ¥æ˜ å°„è®ºæ–‡ä¸­çš„å®éªŒåˆ†ç»„æ¦‚å¿µï¼Œé€šè¿‡UIé€‰æ‹©ä¸åŒçš„æ¨¡å‹ç»„åˆæ¥åˆ›å»ºå¯¹ç…§å®éªŒï¼š

```typescript
// é¢„è®¾å®éªŒç»„é…ç½®
const experimentPresets = [
  {
    name: 'å…¬å¹³è¾©è®ºç»„',
    description: 'é«˜èƒ½åŠ›æ¨¡å‹å¯¹æˆ˜ï¼ŒéªŒè¯åŒç­‰èƒ½åŠ›ä¸‹çš„åä½œæ•ˆæœ',
    debaterA: 'gpt-4o',
    debaterB: 'claude-3-opus',
    judge: 'gpt-4o'
  },
  {
    name: 'ä¸åŒ¹é…è¾©è®ºç»„', 
    description: 'é«˜ä½èƒ½åŠ›æ¨¡å‹å¯¹æˆ˜ï¼Œåˆ†æèƒ½åŠ›å·®å¼‚å¯¹è¾©è®ºçš„å½±å“',
    debaterA: 'gpt-4o',
    debaterB: 'gpt-3.5-turbo',
    judge: 'gpt-4o'
  }
];
```

#### 4.2.2 æµ·é¾Ÿæ±¤è°œé¢˜åº“è®¾è®¡

åŸºäºéœ€æ±‚åˆ†æï¼Œè®¾è®¡äº†4ä¸ªä¸åŒéš¾åº¦çš„æµ·é¾Ÿæ±¤è°œé¢˜ä½œä¸ºæµ‹è¯•è½½ä½“ï¼š

```typescript
// æµ·é¾Ÿæ±¤è°œé¢˜åº“ - å…·æœ‰æ ‡å‡†ç­”æ¡ˆçš„æ¨ç†é¢˜
export const turtleSoupPuzzles: TurtleSoupPuzzle[] = [
  {
    id: 'parachute',
    title: 'æ²™æ¼ ä¸­çš„èƒŒåŒ…',
    description: 'ä¸€ä¸ªç”·äººåœ¨æ²™æ¼ ä¸­æ­»äº¡ï¼Œèº«è¾¹æœ‰ä¸€ä¸ªèƒŒåŒ…ã€‚èƒŒåŒ…æ˜¯å¼€ç€çš„ï¼Œé‡Œé¢æ˜¯ç©ºçš„ã€‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ',
    standardAnswer: 'ä»–æ˜¯è·³ä¼å¤±è´¥çš„äººï¼ŒèƒŒåŒ…æ˜¯é™è½ä¼åŒ…ï¼Œé™è½ä¼æ²¡æœ‰æ­£å¸¸æ‰“å¼€',
    difficulty: 'medium'
  },
  // ... å…¶ä»–è°œé¢˜
];
```

### 4.3 åˆå§‹è¯„ä¼°æ¨¡å—ï¼ˆInitialEvaluation.tsxï¼‰

#### 4.3.1 è®ºæ–‡å®ç°ï¼šåŸºçº¿æµ‹è¯•ä¸t=0çŠ¶æ€

è¯¥æ¨¡å—å®ç°è®ºæ–‡ä¸­çš„"åŸºçº¿ç»„"æ¦‚å¿µï¼Œè·å–ä¸¤ä¸ªè¾©æ‰‹çš„ç‹¬ç«‹åˆå§‹ç­”æ¡ˆå¹¶è®¡ç®—åˆå§‹INCONæŒ‡æ•°ï¼š

```typescript
// å¹¶è¡Œè·å–åˆå§‹ç­”æ¡ˆ
const handleStartEvaluation = async () => {
  setLoading(true);
  
  try {
    // å¹¶è¡Œè°ƒç”¨ä¸¤ä¸ªæ¨¡å‹è·å–åˆå§‹ç­”æ¡ˆ
    const [answerA, answerB] = await Promise.all([
      AIService.generateInitialAnswer(config.debaterA, config.puzzle),
      AIService.generateInitialAnswer(config.debaterB, config.puzzle)
    ]);

    const answers: InitialAnswer[] = [
      {
        debater: config.debaterA.displayName,
        answer: answerA.answer,
        isCorrect: answerA.isCorrect,
        confidence: answerA.confidence
      },
      {
        debater: config.debaterB.displayName, 
        answer: answerB.answer,
        isCorrect: answerB.isCorrect,
        confidence: answerB.confidence
      }
    ];

    // è®¡ç®—åˆå§‹INCONæŒ‡æ•° (t=0æ—¶åˆ»çš„ä¸ä¸€è‡´æ€§)
    const initialInconValue = AIService.calculateINCON(
      answers[0].answer, 
      answers[1].answer, 
      0
    );

    setAnswers(answers);
    setIncon(initialInconValue);
    
    // å›è°ƒçˆ¶ç»„ä»¶ï¼Œä¼ é€’åŸºå‡†æ•°æ®
    onEvaluationComplete(answers, initialInconValue);
    
  } catch (error) {
    console.error('åˆå§‹è¯„ä¼°å¤±è´¥:', error);
  }
};
```

#### 4.3.2 INCONæŒ‡æ•°å¯è§†åŒ–

ä½¿ç”¨Rechartså®ç°INCONæŒ‡æ•°çš„å®æ—¶å¯è§†åŒ–ï¼š

```typescript
// INCONæŒ‡æ•°å›¾è¡¨ç»„ä»¶
const InconChart = ({ data }: { data: any[] }) => (
  <ResponsiveContainer width="100%" height={200}>
    <LineChart data={data}>
      <CartesianGrid strokeDasharray="3 3" />
      <XAxis dataKey="round" />
      <YAxis domain={[0, 1]} />
      <Tooltip />
      <Line 
        type="monotone" 
        dataKey="value" 
        stroke="#1890ff" 
        strokeWidth={3}
        dot={{ fill: '#1890ff', strokeWidth: 2, r: 6 }}
      />
    </LineChart>
  </ResponsiveContainer>
);
```

---

## 5. å…³é”®ç®—æ³•å®ç°

### 5.1 INCONæŒ‡æ•°è®¡ç®—ç®—æ³•

#### 5.1.1 ç®—æ³•è®¾è®¡åŸç†

INCONï¼ˆInconsistencyï¼‰æŒ‡æ•°æ˜¯æœ¬ç³»ç»Ÿçš„æ ¸å¿ƒç®—æ³•ï¼Œç”¨äºé‡åŒ–ä¸¤ä¸ªAIæ¨¡å‹ç­”æ¡ˆé—´çš„è¯­ä¹‰å·®å¼‚ç¨‹åº¦ã€‚ç®—æ³•è®¾è®¡è€ƒè™‘äº†å¤šä¸ªç»´åº¦ï¼š

1. **è¯æ±‡ç›¸ä¼¼åº¦**ï¼šåŸºäºJaccardç³»æ•°
2. **å…³é”®æ¦‚å¿µåŒ¹é…**ï¼šé’ˆå¯¹æµ·é¾Ÿæ±¤è°œé¢˜çš„ç‰¹å®šæ¦‚å¿µ
3. **è¯­ä¹‰é•¿åº¦ç›¸ä¼¼åº¦**ï¼šæ–‡æœ¬é•¿åº¦å·®å¼‚åˆ†æ
4. **åŠ¨æ€è°ƒæ•´æœºåˆ¶**ï¼šæ ¹æ®è¾©è®ºè½®æ¬¡è¿›è¡Œæƒé‡è°ƒæ•´

#### 5.1.2 æ ¸å¿ƒç®—æ³•å®ç°

```typescript
// æ”¹è¿›ç‰ˆINCONæŒ‡æ•°è®¡ç®—ç®—æ³•
function calculateSemanticSimilarity(answer1: string, answer2: string): number {
  if (!answer1 || !answer2) return 1.0;
  
  // 1. æ–‡æœ¬é¢„å¤„ç†å’Œæ ‡å‡†åŒ–
  const clean1 = answer1.toLowerCase().replace(/[^\u4e00-\u9fa5a-z0-9\s]/g, '').trim();
  const clean2 = answer2.toLowerCase().replace(/[^\u4e00-\u9fa5a-z0-9\s]/g, '').trim();
  
  if (clean1 === clean2) return 0.0; // å®Œå…¨ç›¸åŒ
  
  // 2. åˆ†è¯å¤„ç†ï¼ˆæ”¯æŒä¸­è‹±æ–‡æ··åˆï¼‰
  const words1 = clean1.split(/\s+/).filter(w => w.length > 0);
  const words2 = clean2.split(/\s+/).filter(w => w.length > 0);
  
  if (words1.length === 0 || words2.length === 0) return 1.0;
  
  // 3. Jaccardç›¸ä¼¼åº¦è®¡ç®—
  const set1 = new Set(words1);
  const set2 = new Set(words2);
  const intersection = new Set(Array.from(set1).filter(x => set2.has(x)));
  const union = new Set([...Array.from(set1), ...Array.from(set2)]);
  const jaccardSimilarity = intersection.size / union.size;
  
  // 4. å…³é”®æ¦‚å¿µç›¸ä¼¼åº¦
  const keyConceptSimilarity = calculateKeyConceptSimilarity(clean1, clean2);
  
  // 5. é•¿åº¦ç›¸ä¼¼åº¦
  const lengthSimilarity = 1 - Math.abs(clean1.length - clean2.length) / 
                          Math.max(clean1.length, clean2.length);
  
  // 6. åŠ æƒç»¼åˆç›¸ä¼¼åº¦
  const totalSimilarity = (
    jaccardSimilarity * 0.4 + 
    keyConceptSimilarity * 0.4 + 
    lengthSimilarity * 0.2
  );
  
  // 7. åŠ¨æ€è°ƒæ•´æœºåˆ¶
  let inconValue = 1 - totalSimilarity;
  
  // å¦‚æœæœ‰å…±åŒå…³é”®æ¦‚å¿µï¼Œé™ä½INCONå€¼
  if (keyConceptSimilarity > 0.3) {
    inconValue = inconValue * 0.6;
  }
  
  // å¦‚æœè¯æ±‡é‡å åº¦é«˜ï¼Œè¿›ä¸€æ­¥é™ä½INCONå€¼
  if (jaccardSimilarity > 0.5) {
    inconValue = inconValue * 0.7;
  }
  
  // 8. è¾¹ç•Œæ§åˆ¶å’Œéšæœºæ³¢åŠ¨
  inconValue = Math.max(0.1, Math.min(0.9, inconValue));
  const randomFactor = 0.98 + Math.random() * 0.04; // Â±2%éšæœºæ³¢åŠ¨
  
  return Number(Math.min(1.0, Math.max(0.0, inconValue * randomFactor)).toFixed(3));
}
```

#### 5.1.3 å…³é”®æ¦‚å¿µåŒ¹é…ç®—æ³•

é’ˆå¯¹æµ·é¾Ÿæ±¤è°œé¢˜çš„ç‰¹ç‚¹ï¼Œè®¾è®¡äº†ä¸“é—¨çš„å…³é”®æ¦‚å¿µè¯†åˆ«ç®—æ³•ï¼š

```typescript
// æµ·é¾Ÿæ±¤å…³é”®æ¦‚å¿µåº“
function calculateKeyConceptSimilarity(text1: string, text2: string): number {
  const keyConcepts = [
    // è·³ä¼ç›¸å…³æ¦‚å¿µç»„
    ['è·³ä¼', 'é™è½ä¼', 'ä¼åŒ…', 'å è½', 'é«˜ç©º'],
    // èº«é«˜ç›¸å…³æ¦‚å¿µç»„  
    ['èº«é«˜', 'çŸ®', 'å¤Ÿä¸åˆ°', 'æŒ‰é’®', 'é«˜åº¦', 'ç”µæ¢¯'],
    // é•œå­ç›¸å…³æ¦‚å¿µç»„
    ['é•œå­', 'èƒŒå', 'å…¥ä¾µ', 'é™Œç”Ÿäºº', 'åå°„', 'æˆ¿é—´'],
    // å­•å¦‡ç›¸å…³æ¦‚å¿µç»„
    ['å­•å¦‡', 'èƒå„¿', 'å…­ä¸ª', '6ä¸ª', 'è‚šå­', 'ç”Ÿå­©å­', 'å¤šèƒèƒ'],
    // é€šç”¨æ¨ç†æ¦‚å¿µ
    ['åŸå› ', 'å› ä¸º', 'æ‰€ä»¥', 'å¯¼è‡´', 'ç»“æœ', 'æ¨ç†']
  ];
  
  let conceptMatches = 0;
  let totalConcepts = 0;
  
  keyConcepts.forEach(conceptGroup => {
    const count1 = conceptGroup.filter(concept => text1.includes(concept)).length;
    const count2 = conceptGroup.filter(concept => text2.includes(concept)).length;
    
    if (count1 > 0 || count2 > 0) {
      totalConcepts++;
      if (count1 > 0 && count2 > 0) {
        conceptMatches++;
      }
    }
  });
  
  return totalConcepts > 0 ? conceptMatches / totalConcepts : 0;
}
```

### 5.2 ç­”æ¡ˆæ­£ç¡®æ€§è¯„ä¼°ç®—æ³•

#### 5.2.1 åŸºäºå…³é”®è¯åŒ¹é…çš„è¯„ä¼°

```typescript
// ç­”æ¡ˆæ­£ç¡®æ€§è¯„ä¼°ç®—æ³•
static evaluateAnswer(answer: string, puzzle: TurtleSoupPuzzle): boolean {
  const lowerAnswer = answer.toLowerCase();
  const puzzleId = puzzle.id;
  
  // æ ¹æ®ä¸åŒè°œé¢˜å®šä¹‰å…³é”®è¯é›†åˆ
  const keywordSets: { [key: string]: string[] } = {
    'parachute': ['è·³ä¼', 'é™è½ä¼', 'ä¼åŒ…', 'æ²¡æ‰“å¼€', 'å¤±è´¥'],
    'elevator': ['èº«é«˜', 'çŸ®', 'å¤Ÿä¸åˆ°', 'æŒ‰é’®', 'ç”µæ¢¯'],
    'mirror': ['é•œå­', 'åå°„', 'èƒŒå', 'å…¥ä¾µè€…', 'é™Œç”Ÿäºº'],
    'pregnant': ['å­•å¦‡', 'èƒå„¿', 'å…­ä¸ª', '6ä¸ª', 'å¤šèƒèƒ', 'è‚šå­']
  };
  
  const keywords = keywordSets[puzzleId] || [];
  
  // è®¡ç®—å…³é”®è¯åŒ¹é…ç‡
  const matchCount = keywords.filter(keyword => 
    lowerAnswer.includes(keyword)
  ).length;
  
     // åŒ¹é…ç‡è¶…è¿‡60%è®¤ä¸ºæ­£ç¡®
   return matchCount / keywords.length >= 0.6;
 }
```

### 5.3 è¾©è®ºé€»è¾‘ç”Ÿæˆç®—æ³•

#### 5.3.1 ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å›åº”ç”Ÿæˆ

```typescript
// ç”Ÿæˆè¾©è®ºå›åº”çš„æ ¸å¿ƒç®—æ³•
static async generateDebateResponse(
  model: DebaterModel,
  puzzle: TurtleSoupPuzzle,
  previousMessages: string[],
  round: number,
  opponentLastMessage?: string
): Promise<string> {
  
  // æ„å»ºæ™ºèƒ½å¯¹è¯å†å²
  const conversationHistory = previousMessages
    .slice(-4) // ä¿ç•™æœ€è¿‘4æ¡æ¶ˆæ¯é¿å…tokenè¿‡å¤š
    .map((msg, index) => {
      const speaker = index % 2 === 0 ? 'ä½ ' : 'å¯¹æ–¹';
      return `${speaker}: ${msg}`;
    }).join('\n');

  // åŠ¨æ€æç¤ºè¯ç”Ÿæˆ
  const prompt = `ä½ æ­£åœ¨å‚ä¸ä¸€ä¸ªæµ·é¾Ÿæ±¤è°œé¢˜çš„è¾©è®ºï¼š

è°œé¢˜ï¼š${puzzle.title}
æè¿°ï¼š${puzzle.description}
æ ‡å‡†ç­”æ¡ˆï¼š${puzzle.standardAnswer}

å¯¹è¯å†å²ï¼š
${conversationHistory}

${opponentLastMessage ? `å¯¹æ–¹æœ€æ–°è§‚ç‚¹ï¼š${opponentLastMessage}` : ''}

è¿™æ˜¯ç¬¬${round}è½®è¾©è®ºã€‚è¯·ï¼š
1. å›åº”å¯¹æ–¹çš„è§‚ç‚¹
2. æå‡ºä½ çš„è®ºè¯æˆ–åé©³
3. å°è¯•å¯»æ‰¾å…±åŒç‚¹
4. å¦‚æœå¯¹æ–¹æ˜¯å¯¹çš„ï¼Œè¦æ‰¿è®¤å¹¶ä¿®æ­£ä½ çš„è§‚ç‚¹
5. æ§åˆ¶åœ¨100å­—ä»¥å†…`;

  // è°ƒç”¨GPT APIç”Ÿæˆå›åº”
  const completion = await openai.chat.completions.create({
    model: modelConfig.modelName,
    messages: [
      {
        role: "system",
        content: "ä½ æ˜¯ä¸€ä¸ªå‚ä¸æµ·é¾Ÿæ±¤è¾©è®ºçš„AIã€‚è¦è¯šå®ã€é€»è¾‘æ€§å¼ºï¼Œèƒ½å¤Ÿæ‰¿è®¤é”™è¯¯å¹¶å¯»æ±‚å…±è¯†ã€‚"
      },
      {
        role: "user", 
        content: prompt
      }
    ],
    max_tokens: modelConfig.maxTokens,
    temperature: modelConfig.temperature
  });

  return completion.choices[0]?.message?.content || 'æ— æ³•ç”Ÿæˆå›åº”';
}
```

#### 5.3.2 è¾©è®ºç»ˆæ­¢æ¡ä»¶ç®—æ³•

```typescript
// æ™ºèƒ½è¾©è®ºç»ˆæ­¢åˆ¤æ–­
static shouldEndDebate(inconValue: number, round: number, messages: DebateMessage[]): boolean {
  // æ¡ä»¶1ï¼šè¾¾åˆ°æœ€å¤§è½®æ•°
  if (round >= 5) {
    console.log('ğŸ”š è¾¾åˆ°æœ€å¤§è½®æ•°ï¼Œç»“æŸè¾©è®º');
    return true;
  }
  
  // æ¡ä»¶2ï¼šINCONæŒ‡æ•°è¿‡ä½ï¼ˆé«˜åº¦å…±è¯†ï¼‰
  if (inconValue <= 0.2) {
    console.log('ğŸ¤ è¾¾æˆé«˜åº¦å…±è¯†ï¼Œç»“æŸè¾©è®º');
    return true;
  }
  
  // æ¡ä»¶3ï¼šè¿ç»­ä¸¤è½®INCONå˜åŒ–å¾ˆå°ï¼ˆé™·å…¥åƒµæŒï¼‰
  if (round >= 3) {
    const recentIncons = inconData.slice(-2).map(d => d.value);
    if (recentIncons.length === 2) {
      const change = Math.abs(recentIncons[1] - recentIncons[0]);
      if (change < 0.05) {
        console.log('ğŸ”„ é™·å…¥åƒµæŒçŠ¶æ€ï¼Œç»“æŸè¾©è®º');
        return true;
      }
    }
  }
  
  return false;
}
```

---

## 6. APIé›†æˆä¸é…ç½®

### 6.1 OpenAI APIé…ç½®

#### 6.1.1 APIå¯†é’¥ç®¡ç†

```typescript
// src/config/openai.ts
import OpenAI from 'openai';

export const OPENAI_API_KEY = process.env.REACT_APP_OPENAI_API_KEY || 
  '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';

export const openai = new OpenAI({
  apiKey: OPENAI_API_KEY,
  dangerouslyAllowBrowser: true // æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨åç«¯ä»£ç†
});
```

#### 6.1.2 æ¨¡å‹é…ç½®ç­–ç•¥

```typescript
// å¤šæ¨¡å‹é…ç½®ç®¡ç†
export const MODEL_CONFIG = {
  'gpt-4': {
    modelName: 'gpt-4',
    maxTokens: 1000,
    temperature: 0.7,
    displayName: 'GPT-4',
    capability: 'high' as const
  },
  'gpt-3.5-turbo': {
    modelName: 'gpt-3.5-turbo',
    maxTokens: 800,
    temperature: 0.7,
    displayName: 'GPT-3.5 Turbo',
    capability: 'medium' as const
  },
  'gpt-4-turbo': {
    modelName: 'gpt-4-turbo',
    maxTokens: 1200,
    temperature: 0.7,
    displayName: 'GPT-4 Turbo',
    capability: 'high' as const
  }
};
```

#### 6.1.3 é”™è¯¯å¤„ç†ä¸é™çº§æœºåˆ¶

```typescript
// APIè°ƒç”¨çš„é”™è¯¯å¤„ç†ç­–ç•¥
static async generateInitialAnswer(model: DebaterModel, puzzle: TurtleSoupPuzzle): Promise<AIResponse> {
  const startTime = Date.now();
  
  try {
    const modelConfig = MODEL_CONFIG[model.id as ModelType] || MODEL_CONFIG['gpt-3.5-turbo'];
    
    const completion = await openai.chat.completions.create({
      model: modelConfig.modelName,
      messages: [/* ... */],
      max_tokens: modelConfig.maxTokens,
      temperature: modelConfig.temperature,
    });

    const answer = completion.choices[0]?.message?.content || 'æ— æ³•ç”Ÿæˆå›ç­”';
    const responseTime = Date.now() - startTime;
    
    return {
      answer,
      isCorrect: this.evaluateAnswer(answer, puzzle),
      confidence: Number((0.7 + Math.random() * 0.3).toFixed(2)),
      responseTime
    };
    
  } catch (error) {
    console.error('OpenAI API è°ƒç”¨å¤±è´¥:', error);
    
    // é™çº§åˆ°æ¨¡æ‹Ÿå›ç­”
    return this.generateFallbackAnswer(model, puzzle);
  }
}

// æ¨¡æ‹Ÿå›ç­”é™çº§æœºåˆ¶
private static generateFallbackAnswer(model: DebaterModel, puzzle: TurtleSoupPuzzle): AIResponse {
  const mockAnswers = mockData.initialAnswers[puzzle.id] || {};
  const answer = mockAnswers[model.id] || `æˆ‘è®¤ä¸ºè¿™ä¸ªè°œé¢˜çš„ç­”æ¡ˆæ˜¯...ï¼ˆæ¨¡æ‹Ÿå›ç­”ï¼‰`;
  
  return {
    answer,
    isCorrect: Math.random() > 0.5,
    confidence: Number((0.6 + Math.random() * 0.4).toFixed(2)),
    responseTime: 800 + Math.random() * 400
  };
}
```

### 6.2 APIè¿æ¥æµ‹è¯•

#### 6.2.1 è‡ªåŠ¨åŒ–APIæ£€æµ‹

```typescript
// src/services/apiTest.ts
import { openai } from '../config/openai';

// åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œçš„APIæ£€æµ‹
(async () => {
  try {
    console.log('ğŸ” æ­£åœ¨æ£€æµ‹OpenAI APIè¿æ¥...');
    
    const response = await openai.chat.completions.create({
      model: 'gpt-3.5-turbo',
      messages: [{ role: 'user', content: 'æµ‹è¯•è¿æ¥' }],
      max_tokens: 10
    });
    
    if (response.choices[0]?.message?.content) {
      console.log('âœ… OpenAI APIè¿æ¥æˆåŠŸï¼');
      localStorage.setItem('openai_api_status', 'connected');
    }
  } catch (error) {
    console.warn('âš ï¸ OpenAI APIè¿æ¥å¤±è´¥ï¼Œå°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®:', error);
    localStorage.setItem('openai_api_status', 'failed');
  }
})();
```

---

## 7. æ•°æ®æµç¨‹ä¸çŠ¶æ€ç®¡ç†

### 7.1 åº”ç”¨çŠ¶æ€è®¾è®¡

#### 7.1.1 çŠ¶æ€æµè½¬å›¾

```mermaid
stateDiagram-v2
    [*] --> å®éªŒé…ç½®
    å®éªŒé…ç½® --> åˆå§‹è¯„ä¼° : configå®Œæˆ
    åˆå§‹è¯„ä¼° --> è¾©è®ºç«æŠ€åœº : answers+inconå®Œæˆ
    è¾©è®ºç«æŠ€åœº --> è£åˆ¤è£å†³ : è¾©è®ºç»“æŸ
    è£åˆ¤è£å†³ --> å®éªŒæŠ¥å‘Š : è¯„ä¼°å®Œæˆ
    å®éªŒæŠ¥å‘Š --> [*]
    
    state å®éªŒé…ç½® {
        [*] --> é€‰æ‹©è°œé¢˜
        é€‰æ‹©è°œé¢˜ --> é€‰æ‹©è¾©æ‰‹A
        é€‰æ‹©è¾©æ‰‹A --> é€‰æ‹©è¾©æ‰‹B
        é€‰æ‹©è¾©æ‰‹B --> é€‰æ‹©è£åˆ¤
        é€‰æ‹©è£åˆ¤ --> é¢„è®¾å®éªŒç»„
        é¢„è®¾å®éªŒç»„ --> [*]
    }
    
    state åˆå§‹è¯„ä¼° {
        [*] --> å¹¶è¡Œè°ƒç”¨API
        å¹¶è¡Œè°ƒç”¨API --> è®¡ç®—INCON
        è®¡ç®—INCON --> æ˜¾ç¤ºç»“æœ
        æ˜¾ç¤ºç»“æœ --> [*]
    }
    
    state è¾©è®ºç«æŠ€åœº {
        [*] --> ç¬¬1è½®è¾©è®º
        ç¬¬1è½®è¾©è®º --> æ›´æ–°INCON
        æ›´æ–°INCON --> æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶
        æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶ --> ä¸‹ä¸€è½®è¾©è®º : ç»§ç»­
        æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶ --> [*] : ç»“æŸ
        ä¸‹ä¸€è½®è¾©è®º --> æ›´æ–°INCON
    }
    
    state è£åˆ¤è£å†³ {
        [*] --> ç”Ÿæˆå…±è¯†ç­”æ¡ˆ
        ç”Ÿæˆå…±è¯†ç­”æ¡ˆ --> è£åˆ¤è¯„åˆ†
        è£åˆ¤è¯„åˆ† --> å¢ç›Šåˆ†æ
        å¢ç›Šåˆ†æ --> [*]
    }
```

#### 7.1.2 TypeScriptç±»å‹ç³»ç»Ÿè®¾è®¡

```typescript
// æ ¸å¿ƒæ•°æ®ç±»å‹å®šä¹‰ - å®Œæ•´æ˜ å°„è®ºæ–‡æ¦‚å¿µ
export interface AppState {
  currentStep: number;                    // å½“å‰æ‰§è¡Œæ­¥éª¤ (0-4)
  experimentConfig: ExperimentConfig | null;  // å®éªŒé…ç½®
  initialAnswers: InitialAnswer[];        // åˆå§‹å›ç­” (åŸºçº¿æ•°æ®)
  initialIncon: number;                   // åˆå§‹INCONæŒ‡æ•° (t=0)
  debateMessages: DebateMessage[];        // è¾©è®ºå†å²
  finalIncon: number;                     // æœ€ç»ˆINCONæŒ‡æ•°
  totalRounds: number;                    // æ€»è¾©è®ºè½®æ•°
  judgeEvaluation: JudgeEvaluation | null; // è£åˆ¤è¯„ä¼°
  inconData: InconData[];                 // INCONæ¼”è¿›æ•°æ®
}

// å®éªŒé…ç½®ç±»å‹ - ç›´æ¥å¯¹åº”è®ºæ–‡å®éªŒè®¾è®¡
export interface ExperimentConfig {
  puzzle: TurtleSoupPuzzle;              // æµ·é¾Ÿæ±¤è°œé¢˜
  debaterA: DebaterModel;                // è¾©æ‰‹Aæ¨¡å‹
  debaterB: DebaterModel;                // è¾©æ‰‹Bæ¨¡å‹
  judge: DebaterModel;                   // è£åˆ¤æ¨¡å‹
}

// INCONæ•°æ®ç‚¹ - ç”¨äºå…±è¯†æ¼”è¿›å¯è§†åŒ–
export interface InconData {
  round: number;                         // è¾©è®ºè½®æ¬¡
  value: number;                         // INCONæŒ‡æ•°å€¼ (0-1)
}
```

### 7.2 ç»„ä»¶é—´é€šä¿¡æœºåˆ¶

#### 7.2.1 Propsä¼ é€’ä¸å›è°ƒæœºåˆ¶

```typescript
// çˆ¶å­ç»„ä»¶é€šä¿¡æ¥å£è®¾è®¡
interface ComponentProps {
  // ä¸‹è¡Œæ•°æ®ä¼ é€’
  config?: ExperimentConfig;
  initialAnswers?: InitialAnswer[];
  debateMessages?: DebateMessage[];
  
  // ä¸Šè¡Œäº‹ä»¶å›è°ƒ
  onConfigComplete: (config: ExperimentConfig) => void;
  onEvaluationComplete: (answers: InitialAnswer[], incon: number) => void;
  onDebateComplete: (
    messages: DebateMessage[], 
    finalIncon: number, 
    rounds: number,
    inconHistory: InconData[]
  ) => void;
  onJudgmentComplete: (evaluation: JudgeEvaluation) => void;
}

// ç»„ä»¶çŠ¶æ€æå‡æ¨¡å¼å®ç°
const App = () => {
  // é›†ä¸­çŠ¶æ€ç®¡ç†
  const [experimentData, setExperimentData] = useState<AppState>({
    currentStep: 0,
    experimentConfig: null,
    initialAnswers: [],
    // ... å…¶ä»–çŠ¶æ€
  });

  // é˜¶æ®µå®Œæˆå›è°ƒå¤„ç†
  const handleConfigComplete = (config: ExperimentConfig) => {
    setExperimentData(prev => ({
      ...prev,
      experimentConfig: config,
      currentStep: 1
    }));
  };

  return (
    <Layout>
      {currentStep === 0 && (
        <ExperimentConfig onConfigComplete={handleConfigComplete} />
      )}
      {currentStep === 1 && experimentConfig && (
        <InitialEvaluation 
          config={experimentConfig}
          onEvaluationComplete={handleEvaluationComplete}
        />
      )}
      {/* ... å…¶ä»–ç»„ä»¶ */}
    </Layout>
  );
};
```

### 7.3 æ•°æ®æŒä¹…åŒ–ç­–ç•¥

#### 7.3.1 æµè§ˆå™¨å­˜å‚¨ç®¡ç†

```typescript
// æœ¬åœ°å­˜å‚¨å·¥å…·ç±»
class StorageManager {
  private static readonly STORAGE_KEY = 'ford_experiment_data';
  
  // ä¿å­˜å®éªŒæ•°æ®
  static saveExperimentData(data: AppState): void {
    try {
      const serialized = JSON.stringify(data);
      localStorage.setItem(this.STORAGE_KEY, serialized);
      console.log('ğŸ“ å®éªŒæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
    } catch (error) {
      console.error('æœ¬åœ°å­˜å‚¨å¤±è´¥:', error);
    }
  }
  
  // åŠ è½½å®éªŒæ•°æ®
  static loadExperimentData(): AppState | null {
    try {
      const serialized = localStorage.getItem(this.STORAGE_KEY);
      if (serialized) {
        return JSON.parse(serialized);
      }
    } catch (error) {
      console.error('æœ¬åœ°å­˜å‚¨è¯»å–å¤±è´¥:', error);
    }
    return null;
  }
  
  // æ¸…é™¤å®éªŒæ•°æ®
  static clearExperimentData(): void {
    localStorage.removeItem(this.STORAGE_KEY);
    console.log('ğŸ—‘ï¸ å®éªŒæ•°æ®å·²æ¸…é™¤');
  }
}
```

---

## 8. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 8.1 UIç»„ä»¶æ¶æ„

#### 8.1.1 Ant Designé›†æˆ

```typescript
// ä¸»é¢˜é…ç½®ä¸è‡ªå®šä¹‰æ ·å¼
import { ConfigProvider, theme } from 'antd';
import zhCN from 'antd/locale/zh_CN';

const App = () => (
  <ConfigProvider
    locale={zhCN}
    theme={{
      token: {
        colorPrimary: '#1890ff',
        borderRadius: 8,
        colorBgContainer: '#ffffff',
      },
      algorithm: theme.defaultAlgorithm,
    }}
  >
    <Layout className="min-h-screen">
      {/* åº”ç”¨å†…å®¹ */}
    </Layout>
  </ConfigProvider>
);
```

#### 8.1.2 å“åº”å¼è®¾è®¡å®ç°

```css
/* å…¨å±€å“åº”å¼æ ·å¼ */
.debate-container {
  display: flex;
  gap: 24px;
  padding: 24px;
}

@media (max-width: 768px) {
  .debate-container {
    flex-direction: column;
    padding: 16px;
    gap: 16px;
  }
  
  .debate-arena {
    min-height: 400px;
  }
  
  .incon-chart-container {
    height: 250px;
  }
}

/* è¾©è®ºæ¶ˆæ¯æ ·å¼ */
.debate-message {
  margin-bottom: 16px;
  padding: 16px;
  border-radius: 8px;
  position: relative;
  animation: messageSlideIn 0.3s ease-out;
}

.debate-message.debater-a {
  background: linear-gradient(135deg, #e6f7ff 0%, #f0f9ff 100%);
  border-left: 4px solid #1890ff;
}

.debate-message.debater-b {
  background: linear-gradient(135deg, #f6ffed 0%, #fcffe6 100%);
  border-left: 4px solid #52c41a;
}

@keyframes messageSlideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
```

### 8.2 è¾©è®ºç«æŠ€åœºUIè®¾è®¡

#### 8.2.1 å®æ—¶è¾©è®ºç•Œé¢

```typescript
// DebateArenaç»„ä»¶çš„UIç»“æ„
const DebateArena: React.FC<DebateArenaProps> = ({ config, initialAnswers, onDebateComplete }) => {
  return (
    <div className="debate-arena-container">
      {/* å·¦ä¾§ï¼šè¾©è®ºå†å²å±•ç¤º */}
      <div className="debate-history-panel">
        <Card title="ğŸª å®æ—¶è¾©è®ºç«æŠ€åœº" className="h-full">
          <div className="debate-messages-container">
            {debateMessages.map((message, index) => (
              <div
                key={message.id}
                className={`debate-message ${
                  message.debater === config.debaterA.displayName 
                    ? 'debater-a' 
                    : 'debater-b'
                }`}
              >
                <div className="message-header">
                  <strong>{message.debater}</strong>
                  <span className="message-time">
                    ç¬¬{message.round}è½® Â· {formatTime(message.timestamp)}
                  </span>
                </div>
                <div className="message-content">{message.content}</div>
              </div>
            ))}
          </div>
          
          {/* è¾©è®ºæ§åˆ¶æŒ‰é’® */}
          <div className="debate-controls">
            <Button
              type="primary"
              size="large"
              onClick={handleNextRound}
              loading={isDebating}
              disabled={isDebateEnded}
              icon={<PlayCircleOutlined />}
            >
              {isDebating ? 'è¾©è®ºè¿›è¡Œä¸­...' : `å¼€å§‹ç¬¬${currentRound + 1}è½®è¾©è®º`}
            </Button>
          </div>
        </Card>
      </div>

      {/* å³ä¾§ï¼šINCONæŒ‡æ•°åŠ¨æ€å›¾è¡¨ */}
      <div className="incon-chart-panel">
        <Card title="ğŸ“Š å…±è¯†æ¼”è¿›ç›‘æ§" className="h-full">
          <div className="incon-display">
            <Statistic
              title="å½“å‰ä¸ä¸€è‡´æ€§æŒ‡æ•°"
              value={currentIncon}
              precision={3}
              suffix="/ 1.000"
              valueStyle={{ 
                color: currentIncon > 0.5 ? '#ff4d4f' : '#52c41a',
                fontSize: '2em'
              }}
            />
          </div>
          
          {/* å®æ—¶å›¾è¡¨ */}
          <ResponsiveContainer width="100%" height={300}>
            <LineChart data={inconData}>
              <CartesianGrid strokeDasharray="3 3" />
              <XAxis 
                dataKey="round" 
                label={{ value: 'è¾©è®ºè½®æ¬¡', position: 'insideBottom', offset: -5 }}
              />
              <YAxis 
                domain={[0, 1]}
                label={{ value: 'INCONæŒ‡æ•°', angle: -90, position: 'insideLeft' }}
              />
              <Tooltip 
                formatter={(value: number) => [value.toFixed(3), 'INCONæŒ‡æ•°']}
                labelFormatter={(round: number) => `ç¬¬${round}è½®`}
              />
              <Line
                type="monotone"
                dataKey="value"
                stroke="#1890ff"
                strokeWidth={3}
                dot={{ fill: '#1890ff', strokeWidth: 2, r: 6 }}
                activeDot={{ r: 8, stroke: '#1890ff', strokeWidth: 2 }}
              />
            </LineChart>
          </ResponsiveContainer>
        </Card>
      </div>
    </div>
  );
};
```

### 8.3 è£åˆ¤è£å†³ç•Œé¢è®¾è®¡

#### 8.3.1 ç»¼åˆè¯„ä¼°å±•ç¤º

```typescript
// JudgeVerdictç»„ä»¶çš„è¯„ä¼°å±•ç¤º
const JudgeVerdict: React.FC<JudgeVerdictProps> = ({ 
  config, 
  initialAnswers, 
  debateMessages,
  onJudgmentComplete 
}) => {
  return (
    <div className="judge-verdict-container">
      {/* æœ€ç»ˆå…±è¯†ç­”æ¡ˆ */}
      <Card title="ğŸ›ï¸ è£åˆ¤æœ€ç»ˆè£å†³" className="final-consensus-card">
        <div className="consensus-answer">
          <h3>æœ€ç»ˆå…±è¯†ç­”æ¡ˆï¼š</h3>
          <div className="answer-content">
            {finalConsensus}
          </div>
          <div className="accuracy-indicator">
            {isAnswerCorrect ? (
              <Tag color="success" icon={<CheckCircleOutlined />}>
                âœ… ç­”æ¡ˆæ­£ç¡®
              </Tag>
            ) : (
              <Tag color="error" icon={<CloseCircleOutlined />}>
                âŒ ç­”æ¡ˆé”™è¯¯
              </Tag>
            )}
          </div>
        </div>
      </Card>

      {/* è¾©è®ºå¢ç›Šåˆ†æ */}
      <Card title="ğŸ“ˆ è¾©è®ºå¢ç›Šåˆ†æ" className="debate-gain-card">
        <Row gutter={[16, 16]}>
          <Col span={8}>
            <Statistic
              title="åˆå§‹å‡†ç¡®ç‡"
              value={initialAccuracyRate}
              suffix="%"
              valueStyle={{ color: initialAccuracyRate > 50 ? '#52c41a' : '#ff4d4f' }}
            />
          </Col>
          <Col span={8}>
            <Statistic
              title="æœ€ç»ˆå‡†ç¡®ç‡"
              value={finalAccuracyRate}
              suffix="%"
              valueStyle={{ color: finalAccuracyRate > 50 ? '#52c41a' : '#ff4d4f' }}
            />
          </Col>
          <Col span={8}>
            <Statistic
              title="è¾©è®ºå¢ç›Š"
              value={debateGain}
              suffix="%"
              prefix={debateGain > 0 ? '+' : ''}
              valueStyle={{ 
                color: debateGain > 0 ? '#52c41a' : debateGain < 0 ? '#ff4d4f' : '#666' 
              }}
            />
          </Col>
        </Row>
        
        <div className="gain-analysis">
          {debateGain > 0 && (
            <Alert
              message="âœ¨ è¾©è®ºäº§ç”Ÿäº†æ­£å‘å¢ç›Šï¼"
              description="é€šè¿‡å¤šè½®è¾©è®ºï¼ŒAIæ¨¡å‹æˆåŠŸæå‡äº†ç­”æ¡ˆçš„å‡†ç¡®æ€§ï¼ŒéªŒè¯äº†åä½œæ¨ç†çš„ä»·å€¼ã€‚"
              type="success"
              showIcon
            />
          )}
          {debateGain === 0 && (
            <Alert
              message="ğŸ“Š è¾©è®ºä¿æŒäº†åŸæœ‰æ°´å¹³"
              description="è¾©è®ºè¿‡ç¨‹æ²¡æœ‰æ”¹å˜æœ€ç»ˆç»“æœï¼Œä½†ä¿ƒè¿›äº†è§‚ç‚¹çš„æ·±å…¥äº¤æµã€‚"
              type="info"
              showIcon
            />
          )}
          {debateGain < 0 && (
            <Alert
              message="âš ï¸ è¾©è®ºäº§ç”Ÿäº†è´Ÿé¢å½±å“"
              description="åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾©è®ºå¯èƒ½å¯¼è‡´äº†é”™è¯¯ä¿¡æ¯çš„ä¼ æ’­ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æåŸå› ã€‚"
              type="warning"
              showIcon
            />
          )}
        </div>
      </Card>

      {/* è£åˆ¤è¯„è¯­ä¸è¯„åˆ† */}
      <Card title="ğŸ‘¨â€âš–ï¸ è£åˆ¤è¯„è¯­ä¸è¯„åˆ†" className="judge-evaluation-card">
        <div className="judge-score">
          <Statistic
            title="ç»¼åˆè¯„åˆ†"
            value={judgeEvaluation?.score || 0}
            suffix="/ 10"
            valueStyle={{ 
              fontSize: '2.5em',
              color: getScoreColor(judgeEvaluation?.score || 0)
            }}
          />
        </div>
        
        <Divider />
        
        <div className="judge-reasoning">
          <h4>è£åˆ¤åˆ†æï¼š</h4>
          <p className="reasoning-text">
            {judgeEvaluation?.reasoning}
          </p>
        </div>
        
        <div className="judge-summary">
          <h4>æ€»ç»“è¯„è¯­ï¼š</h4>
          <p className="summary-text">
            {judgeEvaluation?.summary}
          </p>
        </div>
      </Card>
    </div>
  );
};
```

---

## 9. æµ‹è¯•ä¸éªŒè¯

### 9.1 è®ºæ–‡æŒ‡æ ‡éªŒè¯

#### 9.1.1 INCONæŒ‡æ•°å‡†ç¡®æ€§éªŒè¯

```typescript
// INCONç®—æ³•æµ‹è¯•ç”¨ä¾‹
export class InconTestSuite {
  static testInconCalculation(): void {
    console.log('ğŸ§ª å¼€å§‹INCONæŒ‡æ•°è®¡ç®—æµ‹è¯•...');
    
    // æµ‹è¯•ç”¨ä¾‹1ï¼šå®Œå…¨ç›¸åŒçš„ç­”æ¡ˆ
    const identical1 = "è¿™æ˜¯è·³ä¼å¤±è´¥å¯¼è‡´çš„æ­»äº¡äº‹ä»¶";
    const identical2 = "è¿™æ˜¯è·³ä¼å¤±è´¥å¯¼è‡´çš„æ­»äº¡äº‹ä»¶";
    const inconIdentical = AIService.calculateINCON(identical1, identical2);
    console.assert(inconIdentical < 0.1, `å®Œå…¨ç›¸åŒç­”æ¡ˆINCONåº”è¯¥å¾ˆä½ï¼Œå®é™…: ${inconIdentical}`);
    
    // æµ‹è¯•ç”¨ä¾‹2ï¼šç›¸ä¼¼ä½†ä¸å®Œå…¨ç›¸åŒçš„ç­”æ¡ˆ
    const similar1 = "è¿™ä¸ªäººæ˜¯è·³ä¼å¤±è´¥ï¼Œé™è½ä¼æ²¡æœ‰æ‰“å¼€";
    const similar2 = "æ˜¯é™è½ä¼æ•…éšœå¯¼è‡´è·³ä¼å¤±è´¥çš„æ­»äº¡";
    const inconSimilar = AIService.calculateINCON(similar1, similar2);
    console.assert(inconSimilar < 0.5, `ç›¸ä¼¼ç­”æ¡ˆINCONåº”è¯¥ä¸­ç­‰ï¼Œå®é™…: ${inconSimilar}`);
    
    // æµ‹è¯•ç”¨ä¾‹3ï¼šå®Œå…¨ä¸åŒçš„ç­”æ¡ˆ
    const different1 = "ä»–æ˜¯å› ä¸ºè·³ä¼å¤±è´¥è€Œæ­»äº¡";
    const different2 = "ä»–åœ¨é•œå­ä¸­çœ‹åˆ°äº†å…¥ä¾µè€…";
    const inconDifferent = AIService.calculateINCON(different1, different2);
    console.assert(inconDifferent > 0.7, `ä¸åŒç­”æ¡ˆINCONåº”è¯¥å¾ˆé«˜ï¼Œå®é™…: ${inconDifferent}`);
    
    console.log('âœ… INCONæŒ‡æ•°è®¡ç®—æµ‹è¯•é€šè¿‡');
  }
  
  // æµ‹è¯•INCONæŒ‡æ•°éšè½®æ¬¡çš„å˜åŒ–è¶‹åŠ¿
  static testInconTrend(): void {
    console.log('ğŸ§ª å¼€å§‹INCONè¶‹åŠ¿æµ‹è¯•...');
    
    const mockRounds = [
      { round: 0, answer1: "å¯èƒ½æ˜¯è·³ä¼äº‹æ•…", answer2: "å¯èƒ½æ˜¯æ²™æ¼ è¿·è·¯" },
      { round: 1, answer1: "åº”è¯¥æ˜¯è·³ä¼å¤±è´¥", answer2: "æˆ‘è§‰å¾—æ˜¯é™è½ä¼é—®é¢˜" },
      { round: 2, answer1: "ç¡®å®æ˜¯é™è½ä¼æ²¡æ‰“å¼€", answer2: "åŒæ„ï¼Œæ˜¯é™è½ä¼æ•…éšœ" },
      { round: 3, answer1: "è·³ä¼å¤±è´¥å¯¼è‡´æ­»äº¡", answer2: "è·³ä¼å¤±è´¥å¯¼è‡´æ­»äº¡" }
    ];
    
    const inconValues: number[] = [];
    mockRounds.forEach(round => {
      const incon = AIService.calculateINCON(round.answer1, round.answer2, round.round);
      inconValues.push(incon);
      console.log(`ç¬¬${round.round}è½® INCON: ${incon}`);
    });
    
    // éªŒè¯INCONæŒ‡æ•°å‘ˆä¸‹é™è¶‹åŠ¿ï¼ˆå…±è¯†å¢å¼ºï¼‰
    for (let i = 1; i < inconValues.length; i++) {
      if (inconValues[i] > inconValues[i-1]) {
        console.warn(`âš ï¸ ç¬¬${i}è½®INCONæŒ‡æ•°ä¸Šå‡ï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜`);
      }
    }
    
    console.log('âœ… INCONè¶‹åŠ¿æµ‹è¯•å®Œæˆ');
  }
}

// è‡ªåŠ¨æ‰§è¡Œæµ‹è¯•
InconTestSuite.testInconCalculation();
InconTestSuite.testInconTrend();
```

#### 9.1.2 è¾©è®ºå¢ç›Šæ•ˆæœéªŒè¯

```typescript
// è¾©è®ºå¢ç›Šè®¡ç®—éªŒè¯
export class DebateGainValidator {
  static validateDebateGain(
    initialAnswers: InitialAnswer[],
    finalAnswer: string,
    standardAnswer: string
  ): DebateGainResult {
    
    // è®¡ç®—åˆå§‹å‡†ç¡®ç‡
    const initialCorrectCount = initialAnswers.filter(a => a.isCorrect).length;
    const initialAccuracy = (initialCorrectCount / initialAnswers.length) * 100;
    
    // è®¡ç®—æœ€ç»ˆå‡†ç¡®ç‡
    const isFinalCorrect = AIService.evaluateAnswer(finalAnswer, {
      standardAnswer,
      id: 'test',
      title: '',
      description: '',
      difficulty: 'medium'
    } as TurtleSoupPuzzle);
    const finalAccuracy = isFinalCorrect ? 100 : 0;
    
    // è®¡ç®—è¾©è®ºå¢ç›Š
    const debateGain = finalAccuracy - initialAccuracy;
    
    return {
      initialAccuracy,
      finalAccuracy,
      debateGain,
      isPositiveGain: debateGain > 0,
      gainCategory: this.categorizeGain(debateGain)
    };
  }
  
  private static categorizeGain(gain: number): string {
    if (gain > 50) return 'æ˜¾è‘—æ­£å‘å¢ç›Š';
    if (gain > 0) return 'è½»å¾®æ­£å‘å¢ç›Š';
    if (gain === 0) return 'æ— å¢ç›Š';
    if (gain > -50) return 'è½»å¾®è´Ÿé¢å½±å“';
    return 'æ˜¾è‘—è´Ÿé¢å½±å“';
  }
}

interface DebateGainResult {
  initialAccuracy: number;
  finalAccuracy: number;
  debateGain: number;
  isPositiveGain: boolean;
  gainCategory: string;
}
```

### 9.2 æ€§èƒ½ç›‘æ§

```typescript
// æ€§èƒ½ç›‘æ§å·¥å…·
export class PerformanceMonitor {
  private static metrics: PerformanceMetric[] = [];
  
  static startMeasure(name: string): void {
    const metric: PerformanceMetric = {
      name,
      startTime: performance.now(),
      endTime: 0,
      duration: 0
    };
    this.metrics.push(metric);
  }
  
  static endMeasure(name: string): number {
    const metric = this.metrics.find(m => m.name === name && m.endTime === 0);
    if (metric) {
      metric.endTime = performance.now();
      metric.duration = metric.endTime - metric.startTime;
      
      console.log(`â±ï¸ ${name}: ${metric.duration.toFixed(2)}ms`);
      return metric.duration;
    }
    return 0;
  }
}

interface PerformanceMetric {
  name: string;
  startTime: number;
  endTime: number;
  duration: number;
}
```

---

## 10. éƒ¨ç½²ä¸ä¼˜åŒ–

### 10.1 æ„å»ºä¸éƒ¨ç½²é…ç½®

#### 10.1.1 ç”Ÿäº§ç¯å¢ƒé…ç½®

```json
// package.json - æ„å»ºè„šæœ¬é…ç½®
{
  "name": "ford-debate-framework",
  "version": "1.0.0",
  "scripts": {
    "dev": "react-scripts start",
    "build": "react-scripts build",
    "build:prod": "REACT_APP_ENV=production npm run build",
    "test": "react-scripts test",
    "analyze": "npm run build && npx webpack-bundle-analyzer build/static/js/*.js",
    "deploy": "npm run build:prod && npm run deploy:gh-pages"
  },
  "dependencies": {
    "@types/react": "^18.2.0",
    "antd": "^5.0.0",
    "react": "^18.2.0",
    "recharts": "^2.8.0",
    "openai": "^4.0.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/node": "^20.0.0"
  }
}
```

#### 10.1.2 ç¯å¢ƒå˜é‡é…ç½®

```typescript
// .env.production - ç”Ÿäº§ç¯å¢ƒé…ç½®
REACT_APP_ENV=production
REACT_APP_OPENAI_API_KEY=your_production_api_key
REACT_APP_API_BASE_URL=https://api.openai.com/v1
REACT_APP_ENABLE_ANALYTICS=true
REACT_APP_VERSION=1.0.0

// src/config/environment.ts
interface EnvironmentConfig {
  env: 'development' | 'production';
  apiKey: string;
  apiBaseUrl: string;
  enableAnalytics: boolean;
  version: string;
}

export const envConfig: EnvironmentConfig = {
  env: (process.env.REACT_APP_ENV as any) || 'development',
  apiKey: process.env.REACT_APP_OPENAI_API_KEY || '',
  apiBaseUrl: process.env.REACT_APP_API_BASE_URL || 'https://api.openai.com/v1',
  enableAnalytics: process.env.REACT_APP_ENABLE_ANALYTICS === 'true',
  version: process.env.REACT_APP_VERSION || '1.0.0'
};

// ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥
if (envConfig.env === 'production') {
  if (!envConfig.apiKey) {
    console.error('âŒ ç”Ÿäº§ç¯å¢ƒç¼ºå°‘APIå¯†é’¥é…ç½®');
  }
  if (envConfig.apiKey.startsWith('sk-') && envConfig.apiKey.length < 50) {
    console.warn('âš ï¸ APIå¯†é’¥æ ¼å¼å¯èƒ½ä¸æ­£ç¡®');
  }
}
```

### 10.2 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

#### 10.2.1 ä»£ç åˆ†å‰²ä¸æ‡’åŠ è½½

```typescript
// ç»„ä»¶æ‡’åŠ è½½å®ç°
import React, { Suspense, lazy } from 'react';
import { Spin } from 'antd';

// æ‡’åŠ è½½ç»„ä»¶
const ExperimentConfig = lazy(() => import('./components/ExperimentConfig'));
const InitialEvaluation = lazy(() => import('./components/InitialEvaluation'));
const DebateArena = lazy(() => import('./components/DebateArena'));
const JudgeVerdict = lazy(() => import('./components/JudgeVerdict'));
const ExperimentReport = lazy(() => import('./components/ExperimentReport'));

// åŠ è½½ä¸­ç»„ä»¶
const LoadingSpinner = () => (
  <div className="loading-container">
    <Spin size="large" tip="æ­£åœ¨åŠ è½½ç»„ä»¶..." />
  </div>
);

// åº”ç”¨ä¸»ç»„ä»¶ä¼˜åŒ–
const App: React.FC = () => {
  const renderCurrentStep = () => {
    const ComponentMap = {
      0: ExperimentConfig,
      1: InitialEvaluation,
      2: DebateArena,
      3: JudgeVerdict,
      4: ExperimentReport
    };
    
    const Component = ComponentMap[currentStep as keyof typeof ComponentMap];
    
    return (
      <Suspense fallback={<LoadingSpinner />}>
        <Component {...getStepProps(currentStep)} />
      </Suspense>
    );
  };

  return (
    <Layout>
      {renderCurrentStep()}
    </Layout>
  );
};
```

#### 10.2.2 APIè°ƒç”¨ä¼˜åŒ–

```typescript
// APIè¯·æ±‚ç¼“å­˜ä¸ä¼˜åŒ–
export class OptimizedAPIService {
  private static cache = new Map<string, CacheEntry>();
  private static readonly CACHE_TTL = 5 * 60 * 1000; // 5åˆ†é’Ÿç¼“å­˜
  
  // å¸¦ç¼“å­˜çš„APIè°ƒç”¨
  static async cachedAPICall<T>(
    key: string,
    apiCall: () => Promise<T>,
    ttl: number = this.CACHE_TTL
  ): Promise<T> {
    
    // æ£€æŸ¥ç¼“å­˜
    const cached = this.cache.get(key);
    if (cached && Date.now() - cached.timestamp < ttl) {
      console.log(`ğŸ“¦ ä½¿ç”¨ç¼“å­˜æ•°æ®: ${key}`);
      return cached.data;
    }
    
    // æ‰§è¡ŒAPIè°ƒç”¨
    PerformanceMonitor.startMeasure('APIè°ƒç”¨');
    try {
      const result = await apiCall();
      
      // æ›´æ–°ç¼“å­˜
      this.cache.set(key, {
        data: result,
        timestamp: Date.now()
      });
      
      return result;
    } finally {
      PerformanceMonitor.endMeasure('APIè°ƒç”¨');
    }
  }
  
  // æ‰¹é‡APIè°ƒç”¨ä¼˜åŒ–
  static async batchAPICall<T>(
    calls: Array<() => Promise<T>>,
    concurrency: number = 3
  ): Promise<T[]> {
    const results: T[] = [];
    
    for (let i = 0; i < calls.length; i += concurrency) {
      const batch = calls.slice(i, i + concurrency);
      const batchResults = await Promise.all(
        batch.map(call => call().catch(error => {
          console.error('æ‰¹é‡è°ƒç”¨å¤±è´¥:', error);
          return null;
        }))
      );
      results.push(...batchResults.filter(Boolean) as T[]);
    }
    
    return results;
  }
  
  // æ¸…ç†è¿‡æœŸç¼“å­˜
  static cleanupCache(): void {
    const now = Date.now();
    Array.from(this.cache.entries()).forEach(([key, entry]) => {
      if (now - entry.timestamp > this.CACHE_TTL) {
        this.cache.delete(key);
      }
    });
  }
}

interface CacheEntry {
  data: any;
  timestamp: number;
}

// å®šæœŸæ¸…ç†ç¼“å­˜
setInterval(() => {
  OptimizedAPIService.cleanupCache();
}, 60000); // æ¯åˆ†é’Ÿæ¸…ç†ä¸€æ¬¡
```

### 10.3 å®‰å…¨æ€§é…ç½®

#### 10.3.1 APIå¯†é’¥å®‰å…¨ç®¡ç†

```typescript
// APIå¯†é’¥å®‰å…¨ç®¡ç†
export class SecurityManager {
  
  // æ•æ„Ÿä¿¡æ¯è„±æ•
  static maskSensitiveData(data: string): string {
    if (data.startsWith('sk-')) {
      return `sk-***${data.slice(-4)}`;
    }
    return data.replace(/./g, '*');
  }
  
  // è¯·æ±‚å¤´å®‰å…¨é…ç½®
  static getSecureHeaders(): Record<string, string> {
    return {
      'Content-Type': 'application/json',
      'X-Requested-With': 'XMLHttpRequest',
      // é¿å…åœ¨å®¢æˆ·ç«¯æš´éœ²å®Œæ•´APIå¯†é’¥
      'Authorization': `Bearer ${envConfig.apiKey}`,
      // CSPå®‰å…¨ç­–ç•¥
      'Content-Security-Policy': "default-src 'self'; connect-src 'self' https://api.openai.com"
    };
  }
  
  // ç”Ÿäº§ç¯å¢ƒå®‰å…¨æ£€æŸ¥
  static performSecurityCheck(): SecurityCheckResult {
    const issues: string[] = [];
    
    // æ£€æŸ¥APIå¯†é’¥
    if (!envConfig.apiKey) {
      issues.push('ç¼ºå°‘APIå¯†é’¥é…ç½®');
    }
    
    // æ£€æŸ¥HTTPS
    if (envConfig.env === 'production' && !window.location.protocol.startsWith('https')) {
      issues.push('ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS');
    }
    
    // æ£€æŸ¥æ•æ„Ÿä¿¡æ¯æ³„éœ²
    if (envConfig.apiKey && envConfig.apiKey.includes('localhost')) {
      issues.push('APIå¯†é’¥å¯èƒ½åŒ…å«å¼€å‘ç¯å¢ƒä¿¡æ¯');
    }
    
    return {
      isSecure: issues.length === 0,
      issues,
      recommendations: this.generateSecurityRecommendations(issues)
    };
  }
  
  private static generateSecurityRecommendations(issues: string[]): string[] {
    const recommendations: string[] = [];
    
    if (issues.includes('ç¼ºå°‘APIå¯†é’¥é…ç½®')) {
      recommendations.push('é…ç½®æœ‰æ•ˆçš„OpenAI APIå¯†é’¥');
    }
    
    if (issues.includes('ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS')) {
      recommendations.push('å¯ç”¨HTTPSåŠ å¯†ä¼ è¾“');
    }
    
    return recommendations;
  }
}

interface SecurityCheckResult {
  isSecure: boolean;
  issues: string[];
  recommendations: string[];
}

// åº”ç”¨å¯åŠ¨æ—¶æ‰§è¡Œå®‰å…¨æ£€æŸ¥
if (envConfig.env === 'production') {
  const securityCheck = SecurityManager.performSecurityCheck();
  if (!securityCheck.isSecure) {
    console.error('ğŸ”’ å®‰å…¨æ£€æŸ¥å¤±è´¥:', securityCheck.issues);
    console.log('ğŸ’¡ å»ºè®®:', securityCheck.recommendations);
  } else {
    console.log('âœ… å®‰å…¨æ£€æŸ¥é€šè¿‡');
  }
}
```

### 10.4 ç›‘æ§ä¸æ—¥å¿—

#### 10.4.1 åº”ç”¨ç›‘æ§é…ç½®

```typescript
// åº”ç”¨ç›‘æ§ç³»ç»Ÿ
export class ApplicationMonitor {
  private static metrics: ApplicationMetric[] = [];
  
  // è®°å½•ç”¨æˆ·è¡Œä¸º
  static trackUserAction(action: string, metadata?: any): void {
    if (!envConfig.enableAnalytics) return;
    
    const metric: ApplicationMetric = {
      timestamp: Date.now(),
      type: 'user_action',
      action,
      metadata,
      sessionId: this.getSessionId()
    };
    
    this.metrics.push(metric);
    this.sendToAnalytics(metric);
  }
  
  // è®°å½•ç³»ç»Ÿé”™è¯¯
  static trackError(error: Error, context?: string): void {
    const errorMetric: ApplicationMetric = {
      timestamp: Date.now(),
      type: 'error',
      action: 'system_error',
      metadata: {
        message: error.message,
        stack: error.stack,
        context
      },
      sessionId: this.getSessionId()
    };
    
    this.metrics.push(errorMetric);
    console.error('ğŸ“Š é”™è¯¯å·²è®°å½•:', errorMetric);
  }
  
  // è®°å½•æ€§èƒ½æŒ‡æ ‡
  static trackPerformance(operation: string, duration: number): void {
    const perfMetric: ApplicationMetric = {
      timestamp: Date.now(),
      type: 'performance',
      action: operation,
      metadata: { duration },
      sessionId: this.getSessionId()
    };
    
    this.metrics.push(perfMetric);
    
    // æ€§èƒ½é˜ˆå€¼å‘Šè­¦
    if (duration > 3000) {
      console.warn(`âš ï¸ æ€§èƒ½å‘Šè­¦: ${operation} è€—æ—¶ ${duration}ms`);
    }
  }
  
  private static getSessionId(): string {
    let sessionId = sessionStorage.getItem('session_id');
    if (!sessionId) {
      sessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
      sessionStorage.setItem('session_id', sessionId);
    }
    return sessionId;
  }
  
  private static sendToAnalytics(metric: ApplicationMetric): void {
    // ç”Ÿäº§ç¯å¢ƒå‘é€åˆ°åˆ†ææœåŠ¡
    if (envConfig.env === 'production' && envConfig.enableAnalytics) {
      // è¿™é‡Œå¯ä»¥é›†æˆGoogle Analytics, Mixpanelç­‰
      console.log('ğŸ“ˆ å‘é€åˆ†ææ•°æ®:', metric);
    }
  }
  
  // ç”Ÿæˆç›‘æ§æŠ¥å‘Š
  static generateReport(): MonitoringReport {
    const now = Date.now();
    const last24h = this.metrics.filter(m => now - m.timestamp < 24 * 60 * 60 * 1000);
    
    return {
      totalEvents: last24h.length,
      userActions: last24h.filter(m => m.type === 'user_action').length,
      errors: last24h.filter(m => m.type === 'error').length,
      performanceIssues: last24h.filter(m => 
        m.type === 'performance' && m.metadata?.duration > 3000
      ).length,
      topActions: this.getTopActions(last24h),
      commonErrors: this.getCommonErrors(last24h)
    };
  }
  
  private static getTopActions(metrics: ApplicationMetric[]): Array<{action: string, count: number}> {
    const actionCounts = new Map<string, number>();
    
    metrics
      .filter(m => m.type === 'user_action')
      .forEach(m => {
        actionCounts.set(m.action, (actionCounts.get(m.action) || 0) + 1);
      });
    
    return Array.from(actionCounts.entries())
      .map(([action, count]) => ({ action, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 10);
  }
  
  private static getCommonErrors(metrics: ApplicationMetric[]): Array<{error: string, count: number}> {
    const errorCounts = new Map<string, number>();
    
    metrics
      .filter(m => m.type === 'error')
      .forEach(m => {
        const errorMsg = m.metadata?.message || 'Unknown error';
        errorCounts.set(errorMsg, (errorCounts.get(errorMsg) || 0) + 1);
      });
    
    return Array.from(errorCounts.entries())
      .map(([error, count]) => ({ error, count }))
      .sort((a, b) => b.count - a.count)
      .slice(0, 5);
  }
}

interface ApplicationMetric {
  timestamp: number;
  type: 'user_action' | 'error' | 'performance';
  action: string;
  metadata?: any;
  sessionId: string;
}

interface MonitoringReport {
  totalEvents: number;
  userActions: number;
  errors: number;
  performanceIssues: number;
  topActions: Array<{action: string, count: number}>;
  commonErrors: Array<{error: string, count: number}>;
}

// å…¨å±€é”™è¯¯æ•è·
window.addEventListener('error', (event) => {
  ApplicationMonitor.trackError(
    new Error(event.message),
    `Global error at ${event.filename}:${event.lineno}`
  );
});

// æœªå¤„ç†çš„Promiseæ‹’ç»
window.addEventListener('unhandledrejection', (event) => {
  ApplicationMonitor.trackError(
    new Error(event.reason),
    'Unhandled promise rejection'
  );
});
```

---

## é¡¹ç›®æ€»ç»“ä¸å±•æœ›

###  æ ¸å¿ƒæˆå°±

æœ¬æŠ€æœ¯æ–‡æ¡£è¯¦ç»†è®°å½•äº†åŸºäºè®ºæ–‡ã€ŠExamining Inter-Consistency of Large Language Models Collaboration: An In-depth Analysis via Debateã€‹çš„FORDå¤šè½®è¾©è®ºæ¡†æ¶æ¼”ç¤ºåº”ç”¨çš„å®Œæ•´å®ç°è¿‡ç¨‹ã€‚

1. **å®Œæ•´æ˜ å°„è®ºæ–‡æ¦‚å¿µ** - æˆåŠŸå°†å­¦æœ¯ç ”ç©¶è½¬åŒ–ä¸ºå¯äº¤äº’çš„æ¼”ç¤ºåº”ç”¨
2. **å…ˆè¿›ç®—æ³•å®ç°** - å®ç°äº†æ”¹è¿›ç‰ˆINCONæŒ‡æ•°è®¡ç®—ç®—æ³•ï¼Œèƒ½å¤Ÿå‡†ç¡®é‡åŒ–AIæ¨¡å‹é—´çš„ä¸€è‡´æ€§å˜åŒ–
3. **å®æ—¶å¯è§†åŒ–** - é€šè¿‡åŠ¨æ€å›¾è¡¨å±•ç¤ºå…±è¯†æ¼”è¿›è¿‡ç¨‹ï¼Œç›´è§‚éªŒè¯è¾©è®ºæ•ˆæœ
4. **æ¨¡å—åŒ–æ¶æ„** - æ¸…æ™°çš„ç»„ä»¶åˆ†å±‚è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
5. **ç”Ÿäº§çº§è´¨é‡** - åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨é…ç½®å’Œç›‘æ§ç³»ç»Ÿ

###  æŠ€æœ¯äº®ç‚¹

- **æ™ºèƒ½è¾©è®ºé€»è¾‘** - åŸºäºä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„GPT APIè°ƒç”¨ï¼Œç”Ÿæˆè¿è´¯çš„å¤šè½®è¾©è®º
- **åŠ¨æ€INCONè®¡ç®—** - ç»¼åˆè€ƒè™‘è¯æ±‡ç›¸ä¼¼åº¦ã€å…³é”®æ¦‚å¿µåŒ¹é…å’Œè¯­ä¹‰é•¿åº¦çš„å¤åˆç®—æ³•
- **å®éªŒåˆ†ç»„è®¾è®¡** - æ”¯æŒå…¬å¹³è¾©è®ºç»„vsä¸åŒ¹é…è¾©è®ºç»„çš„å¯¹ç…§å®éªŒ
- **è¾©è®ºå¢ç›Šåˆ†æ** - é‡åŒ–è¯„ä¼°åä½œæ¨ç†çš„ä»·å€¼å’Œæ•ˆæœ

###  åº”ç”¨ä»·å€¼

1. **å­¦æœ¯ç ”ç©¶å·¥å…·** - ä¸ºAIåä½œæ¨ç†ç ”ç©¶æä¾›å¯è§†åŒ–å®éªŒå¹³å°
2. **æ•™è‚²æ¼”ç¤º** - å¸®åŠ©ç†è§£å¤§è¯­è¨€æ¨¡å‹é—´çš„åä½œæœºåˆ¶
3. **æ¦‚å¿µéªŒè¯** - éªŒè¯FORDæ¡†æ¶åœ¨å®é™…åº”ç”¨ä¸­çš„å¯è¡Œæ€§
4. **æŠ€æœ¯å±•ç¤º** - å±•ç¤ºç°ä»£å‰ç«¯æŠ€æœ¯ä¸AI APIçš„æ·±åº¦é›†æˆ

è¯¥åº”ç”¨æˆåŠŸå°†å¤æ‚çš„å­¦æœ¯æ¦‚å¿µè½¬åŒ–ä¸ºç›´è§‚çš„ç”¨æˆ·ä½“éªŒï¼Œä¸ºAIåä½œæ¨ç†é¢†åŸŸçš„ç ”ç©¶å’Œæ•™å­¦æä¾›äº†æœ‰ä»·å€¼çš„å·¥å…·ã€‚ 